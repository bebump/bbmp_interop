# About

`bbmp_interop` is an automatic code-generator for `pybind11` and a
corresponding CMake module.

It aims to reduce the user written boilerplate to an absolute minimum, when
exporting C++ functions to a Python extension module. If you have a target
`foo` written in C++, adding the following line to your build will create a
shared library target, i.e. a Python extension module, called `pyfoo`.

    bbmp_add_python_module(pyfoo LINK_LIBRARIES foo)

The module is entirely autogenerated, and will expose any function in `foo` 
that was annotated with the `EXPORT_TO_PYTHON` definition.

The original library target `foo` will remain unchanged. It does not need to
depend on Python as `pybind11` can convert between many C++ STL and Python
types. Moreover `bbmp_interop` can convert between Numpy `ndarray` parameters
and a thin wrapper type that has no dependency on Python.

The `pybind11` library is included, so the only dependency you need to meet is
Python.


# Usage

The `bbmp_add_python_module` command will use the CMake internal `FindPython`
search module to find the Python version to link against. In order to specify
a particular version or virtual environment, set the `Python_ROOT_DIR`
variable to the directory containing the interpreter executable that's right
for you.

The library you want to export functions from need not depend on Python. You
can use standard types that `pybind11` understands. In case you want to have a
Numpy `ndarray` as a parameter, you can use the `bbmp::OwnedChannelData<T>`
type. This type does not depend on Python, so you can include the
`bbmp/types.hpp` header without any further dependencies.

Inside the autogenerated Python module types of `bbmp::OwnedChannelData<T>`
will be translated to parameters of Numpy `ndarray`. The
`bbmp::OwnedChannelData<T>` parameter of your function will have ownership
over the `ndarray` created in Python, so you can safely keep it even after the
exported function returns.


# In-source dependencies

pybind11 version v2.5.0 from the stable branch.
  https://github.com/pybind/pybind11 Copyright (c) 2016 Wenzel Jakob
  <wenzel.jakob@epfl.ch>, All rights reserved. Licensed under the 3-clause BSD
  license.


# Misc

Calling `bbmp_add_python_module` will create three targets: `extern_pybind11`,
`bbmp_python_conversions` and the Python extension module, the name of which
is the first argument of `bbmp_add_python_module`.

This function calls CMake's `FindPython` find module internally. Specify 
`Python_ROOT_DIR` or `Python_VERSION` if you want to influence its result.
